<h2 class="text-2xl font-semibold">Empresas</h2>


<div class="container mx-auto mt-4">
    <mat-card class="mat-elevation-z6 rounded-lg">
        <mat-card-header class="px-4">
            <div class="flex flex-col md:flex-row justify-end items-center w-full gap-4 md:gap-0">
                <!-- Campo de búsqueda -->
                <!-- <mat-form-field appearance="outline" class="w-full md:w-1/3">
                    <mat-label>Buscar usuario</mat-label>
                    <mat-icon matPrefix>person_search</mat-icon>
                    <input matInput placeholder="Buscar" [formControl]="search">
                </mat-form-field> -->

                <div class="flex gap-4 justify-center md:justify-end w-full md:w-auto">
                    <!-- Botón para registrar un nuevo usuario -->
                    <button mat-raised-button color="primary" class="flex items-center gap-2"
                        (click)="openNewCompanyDialog()">
                        <mat-icon>person_add</mat-icon>
                        Nueva empresa
                    </button>
                
                </div>
            </div>
        </mat-card-header>

        <mat-card-content>
            <div class="overflow-x-auto">
 
                    <table mat-table [dataSource]="companies" class="mat-elevation-z8">
                        <!-- Razón Social Column -->
                        <ng-container matColumnDef="social_reason">
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Razón Social</th>
                            <td mat-cell *matCellDef="let company">{{ company.social_reason }}</td>
                        </ng-container>

                        <!-- RUT Column -->
                        <ng-container matColumnDef="rut" >
                            <th mat-header-cell *matHeaderCellDef class="font-bold">RUT</th>
                            <td mat-cell *matCellDef="let company">{{ company.rut }}</td>
                        </ng-container>

                        <!-- Dirección Fiscal Column -->
                        <ng-container matColumnDef="fiscal_address">
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Dirección Fiscal</th>
                            <td mat-cell *matCellDef="let company">{{ company.fiscal_address }}</td>
                        </ng-container>

                        <!-- Representante Column -->
                        <ng-container matColumnDef="representative">
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Representante</th>
                            <td mat-cell *matCellDef="let company">
                                {{ company.representative_first_name }} {{ company.representative_last_name }}
                            </td>
                        </ng-container>

                        <!-- Número de Documento Column -->
                        <ng-container matColumnDef="document_number" >
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Número de Documento</th>
                            <td mat-cell *matCellDef="let company">{{ company.document_number }}</td>
                        </ng-container>

                        <!-- Teléfono Comercial Column -->
                        <ng-container matColumnDef="business_phone" >
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Teléfono Comercial</th>
                            <td mat-cell *matCellDef="let company">{{ company.business_phone }}</td>
                        </ng-container>

                        <!-- Celular Column -->
                        <ng-container matColumnDef="cellphone" >
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Celular</th>
                            <td mat-cell *matCellDef="let company">{{ company.cellphone }}</td>
                        </ng-container>

                        <!-- Email Column -->
                        <ng-container matColumnDef="email" class="font-bold">
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Email</th>
                            <td mat-cell *matCellDef="let company">{{ company.email }}</td>
                        </ng-container>

                        <!-- Número de Locales Column -->
                        <ng-container matColumnDef="number_of_locations" class="font-bold">
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Número de Locales</th>
                            <td mat-cell *matCellDef="let company">{{ company.number_of_locations }}</td>
                        </ng-container>

                        <!-- Nombre de Compañía Column -->
                        <ng-container matColumnDef="company_name" class="font-bold">
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Nombre de la Compañía</th>
                            <td mat-cell *matCellDef="let company">{{ company.company_name }}</td>
                        </ng-container>

                        <!-- Estado Column -->
                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef class="font-bold">Estado</th>
                            <td mat-cell *matCellDef="let company">
                                <span [class.active]="company.status" [class.inactive]="!company.status">
                                    {{ company.status ? 'Activo' : 'Inactivo' }}
                                </span>
                            </td>
                        </ng-container>

                        <!-- Acciones Column -->
                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef class="font-bold p-4"> Acciones </th>
                            <td mat-cell *matCellDef="let company">
                              <button mat-icon-button [matMenuTriggerFor]="menu">
                                <mat-icon>more_vert</mat-icon>
                              </button>
                              <mat-menu #menu="matMenu">
                                <button mat-menu-item (click)="editCompany(company)">
                                  <mat-icon color="primary">edit</mat-icon>
                                  <span>Editar</span>
                                </button>
                   
                                <button mat-menu-item (click)="deleteCompany(company)">
                                    <mat-icon [color]="company.status ? 'warn' : 'primary'">
                                        {{ company.status ? 'toggle_off' : 'toggle_on' }}
                                    </mat-icon>
                                    <span>{{ company.status ? 'Desactivar' : 'Activar' }}</span>
                                  </button>
                              </mat-menu>
                            </td>
                          </ng-container>
                

                        <!-- Header and Row Declarations -->
                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        
                    </table>
                    
                    
                </div>
                <mat-paginator 
                    [pageSize]="5" 
                    [pageSizeOptions]="[5, 10, 20]"
                >
                </mat-paginator>
        </mat-card-content>


    </mat-card>
</div>